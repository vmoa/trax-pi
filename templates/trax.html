<!DOCTYPE html>
<html>
    <head>
        <title>T-Rax: The RFO Roof Controller</title>
        <style>

            html, body {
                width: 431px;
                height: 365px;
                margin: 0;
                padding: 0;
                background-color: green;
            }

            #container {
                width: inherit;
                height: inherit;
                margin: 0;
                padding: 0;
                background-color: #60B3B3;
            }

            div.tag_centered {
                position: fixed;
                width: 120px;
                height: 28px;
                text-align: center;
                color: black;
                font-size: 13px;
            }

            div.tag_right {
                position: fixed;
                width: 120px;
                height: 28px;
                text-align: right;
                color: black;
                font-size: 13px;
            }

            div.title_bar {
                position: fixed;
                width: 429px;
                height: 18px;
                line-height: 18px;
                border: 0px;
                padding: 1px;
                background-color: #B3B3FF;
                text-align: center;
                color: #0B00FF;
                font-size: 16px;
            }

            div.indicator_wide {
                position: fixed;
                width: 100px;
                height: 28px;
                line-height: 28px;
                border: 1px solid white;
                border-radius: 5px;
                padding: 1px;
                border-color: #B3DADA;
                background-color: yellow;
                text-align: center;
                color: red;
                font-size: 16px;
            }

            div.indicator_narrow {
                position: fixed;
                width: 40px;
                height: 28px;
                line-height: 28px;
                border: 1px solid white;
                border-radius: 5px;
                padding: 1px;
                border-color: #B3DADA;
                background-color: yellow;
                text-align: center;
                color: red;
                font-size: 16px;
            }

            /* Text area: 32 wide x 3 tall */
            div.notice_box {
                position: fixed;
                width: 188px;
                height: 40px;
                line-height: 14px;
                border: 1px solid white;
                padding: 3px;
                border-color: #B3DADA;
                background-color: yellow;
                text-align: left;
                color: #black;
                font-family: "Lucida Console", "Courier New", monospace;
                font-size: 14px;
            }

            /* Text area: 32 wide x 3 tall */
            div.ticker_box {
                position: fixed;
                width: 188px;
                height: 14px;
                line-height: 14px;
                text-align: right;
                color: #black;
                font-family: "Lucida Console", "Courier New", monospace;
                font-size: 14px;
            }

            div.button_normal {
                position: fixed;
                width: 50px;
                height: 38px;
                line-height: 38px;
                border: 1px solid white;
                border-radius: 12px;
                padding: 1px;
                border-color: #B3DADA;
                background-color: #FF0800;
                text-align: center;
                color: yellow;
                font-size: 16px;
                cursor: pointer;
            }

            div.button_start_stop {
                position: fixed;
                width: 75px;
                height: 45px;
                line-height: 24px;
                border: 1px solid white;
                border-radius: 12px;
                padding: 10px;
                border-color: #B3DADA;
                background-color: #00FF00;
                text-align: center;
                color: #0B00FF;
                font-size: 20px;
                cursor: pointer;
            }

            div.button_emergency_stop {
                position: fixed;
                width: 100px;
                height: 38px;
                line-height: 18px;
                border: 1px solid white;
                border-radius: 12px;
                padding: 2px;
                border-color: #B3DADA;
                background-color: #FF0800;
                text-align: center;
                color: yellow;
                font-family: sans-serif;
                font-size: 15px;
                cursor: pointer;
            }

        </style>

        <script type="text/javascript">

            var black  = 'black';
            var yellow = 'yellow';
            var green  = '#00FF00';
            var red    = '#FF0800';

            // event:innerHTML { id: 'notice', data: 'msg' }
            function set_innerHTML(e) {
                var o = JSON.parse(e.data);
                //console.log("document.getElementById("+o.id+").innerHTML = "+o.data);
                document.getElementById(o.id).innerHTML = o.data;
            }

            // event:bgcolor: { id: 'indicatorX', data: '#FF0800' }
            function set_bgcolor(e) {
                var o = JSON.parse(e.data);
                //console.log("document.getElementById("+o.id+").style.backgroundColor = "+o.data);
                document.getElementById(o.id).style.backgroundColor = o.data;
            }

            // event:fgcolor { id: 'indicatorX', data: '#FF0800' }
            function set_fgcolor(e) {
                var o = JSON.parse(e.data);
                //console.log("document.getElementById("+o.id+").style.color = "+o.data);
                document.getElementById(o.id).style.color = o.data;
            }

            // event:indicator { id: 'indicator_y', status: 'on|off|open|midway|closed|parked|notparked' }
            function update_indicator(e) {
                var o = JSON.parse(e.data);
                //console.log("update_indicator() set "+o.id+" to "+o.status);
                element = document.getElementById(o.id);
                if (o.id == "roof_position" && o.status == 'open') {
                    element.style.backgroundColor = green;
                    element.style.color = black;
                    element.innerHTML = 'OPEN';
                } else if (o.id == "roof_position" && o.status == 'midway') {
                    element.style.backgroundColor = yellow;
                    element.style.color = black;
                    element.innerHTML = 'MIDWAY';
                } else if (o.id == "roof_position" && o.status == 'closed') {
                    element.style.backgroundColor = red;
                    element.style.color = yellow;
                    element.innerHTML = 'CLOSED';
                } else if (o.id == "mount_position" && o.status == 'parked') {
                    element.style.backgroundColor = green;
                    element.style.color = black;
                    element.innerHTML = 'PARKED';
                } else if (o.id == "mount_position" && o.status == 'notparked') {
                    element.style.backgroundColor = red;
                    element.style.color = yellow;
                    element.innerHTML = 'NOT PARKED';
                } else if (o.status == 'on') {
                    element.style.backgroundColor = green;
                    element.style.color = black;
                    element.innerHTML = 'ON';
                } else if (o.status == 'off') {
                    element.style.backgroundColor = red;
                    element.style.color = yellow;
                    element.innerHTML = 'OFF';
                } else {
                    console.log("update_indicator(): unknown event id:"+o.id+" status:"+o.status);
                }
            }

            // Connect to SSE source and register event handlers (listeners)
            if (typeof(EventSource) !== "undefined") {
                    // Create an SSE EventSource and connect to URL
                    var eSource = new EventSource("connect");
                    // Register message handlers
                    eSource.addEventListener("innerHTML", set_innerHTML);
                    eSource.addEventListener("bgcolor", set_bgcolor);
                    eSource.addEventListener("fgcolor", set_fgcolor);
                    eSource.addEventListener("indicator", update_indicator);
            }
            else {
                    document.getElementById("notice").innerHTML="Whoops! Your browser does<br/>not receive server-sent events.";
            }

            function doSend(url) {
                console.log("doSend(" + url + ")")
                var xhr = new XMLHttpRequest();
                xhr.open("GET", url, true);
                xhr.send(null);
            }

        </script>

    </head>

    <!-- body onload="window.resizeTo(500,500);
         chrome.windows.WINDOW_ID_CURRENT.update( { width: 500 });"
         comment="This does not work" -->

    <body>

        <div id="container">

            <div class="title_bar" id="title_bar" style="top:0px; left:0px">&nbsp;T-Rax &mdash; RFO EAST WING ROOF CONTROL</div>

            <div class="tag_centered" style="top:30px; left:50px">ROOF POSITION</div>
            <div class="indicator_wide" id="roof_position" style="top:46px; left:60px">UNKNOWN</div>

            <div class="tag_centered" style="top:100px; left:50px">MOUNT POSITION</div>
            <div class="indicator_wide" id="mount_position" style="top:116px; left:60px">UNKNOWN</div>

            <div class="tag_centered" style="top:170px; left:50px">POWER STATUS</div>
            <div class="tag_right" style="top:198px; left:0px">BUILDING PWR</div>
            <div class="indicator_narrow" id="building_pwr" style="top:190px; left:125px">UNK</div>

            <div class="tag_right" style="top:248px; left:0px">ROOF PWR</div>
            <div class="indicator_narrow" id="roof_pwr" style="top:240px; left:125px">UNK</div>

            <div class="tag_right" style="top:298px; left:0px">MOUNT PWR</div>
            <div class="indicator_narrow" id="mount_pwr" style="top:290px; left:125px">UNK</div>

            <div class="notice_box" id="notice" style="top:28px; left:220px">
                ======================<br/>
                = Connecting to TRax =<br/>
                ======================<br/>
            </div>

            <div class="tag_right" style="top:96px; left:175px; font-size:17px">Roof Power</div>
            <div class="button_normal" id="roof_pwr_on" style="top:86px; left:300px; background-color:#00FF00; color:black" onClick="doSend('/roofpwr?on')";>ON</div>
            <div class="button_normal" id="roof_pwr_off" style="top:86px; left:365px; background-color:#FF0800; color:yellow" onClick="doSend('/roofpwr?off')";>OFF</div>

            <div class="tag_right" style="top:146px; left:175px; font-size:17px">Mount Power</div>
            <div class="button_normal" id="mount_pwr_on" style="top:136px; left:300px; background-color:#00FF00; color:black" onClick="doSend('/mountpwr?on')";>ON</div>
            <div class="button_normal" id="roof_pwr_off" style="top:136px; left:365px; background-color:#FF0800; color:yellow" onClick="doSend('/mountpwr?off')";>OFF</div>

            <div class="button_start_stop" id="start_stop" style="top:195px; left:265px;" onClick="doSend('/startstop')";>START STOP</div>
            <div class="button_emergency_stop" id="emergency_stop" style="top:280px; left:260px" onClick="doSend('/STOP')";>EMERGENCY STOP</div>

            <div class="ticker_box" id="ticker" style="top:345px; left:230px">Tick Tock</div>
        </div>

    </body>
</html>
